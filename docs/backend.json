{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account for the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number."
        },
        "document": {
          "type": "string",
          "description": "The user's document number (e.g., CPF)."
        },
        "balance": {
          "type": "number",
          "description": "The user's account balance."
        },
        "win_percentage": {
          "type": "number",
          "description": "The user's win percentage chance, from 1 to 100."
        },
        "referralCode": {
          "type": "string",
          "description": "The user's unique referral code."
        },
        "commission": {
          "type": "number",
          "description": "The user's referral commission percentage."
        },
        "xp": {
          "type": "number",
          "description": "The user's experience points."
        },
        "level": {
          "type": "number",
          "description": "The user's current level."
        },
        "referredBy": {
          "type": "string",
          "description": "The UID of the user who referred this user."
        },
        "totalCommission": {
          "type": "number",
          "description": "The total commission earned by this user from their referrals."
        },
        "referralsCount": {
          "type": "number",
          "description": "The number of users referred by this user."
        },
        "depositCount": {
          "type": "number",
          "description": "The number of deposits made by the user."
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    },
    "ReferralCode": {
      "title": "Referral Code",
      "description": "Maps a unique referral code to its owner's user ID.",
      "type": "object",
      "properties": {
        "userId": {
          "type": "string",
          "description": "The UID of the user who owns this referral code."
        }
      },
      "required": ["userId"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the authenticated user can access their own profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, matching the Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/referralCodes/{code}",
        "definition": {
          "entityName": "ReferralCode",
          "schema": {
            "$ref": "#/backend/entities/ReferralCode"
          },
          "description": "Stores unique referral codes and their owner's UID to ensure uniqueness and enable lookups."
        }
      }
    ],
    "reasoning": "Based on the provided information, the application 'Black Canvas' primarily focuses on user authentication. The core data revolves around user accounts. Therefore, the Firestore structure is designed to securely store user data, leveraging path-based ownership for private user information. This approach provides Authorization Independence because security rules can be written to only allow access to a user's document based on their `uid`, without needing to read any data from other documents. The design also trivially satisfies the QAPs because listing is restricted to each user's own data."
  }
}
